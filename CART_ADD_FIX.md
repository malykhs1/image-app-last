# üõí –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã "Product is already sold out" (422 error)

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä –≤ –∫–æ—Ä–∑–∏–Ω—É —á–µ—Ä–µ–∑ `/cart/add.js` –≤–æ–∑–Ω–∏–∫–∞–ª–∏ –æ—à–∏–±–∫–∏:

### –û—à–∏–±–∫–∞ 1: "Parameter Missing or Invalid"
```json
{
  "status": "bad_request",
  "message": "Parameter Missing or Invalid",
  "description": "Required parameter missing or invalid: items"
}
```

### –û—à–∏–±–∫–∞ 2: "Product is already sold out" (422)
```json
{
  "status": 422,
  "message": "The product '◊ô◊¶◊ô◊®◊î ◊û◊ï◊™◊ê◊û◊™ ◊ê◊ô◊©◊ô◊™ - 40x40cm' is already sold out.",
  "description": "The product '◊ô◊¶◊ô◊®◊î ◊û◊ï◊™◊ê◊û◊™ ◊ê◊ô◊©◊ô◊™ - 40x40cm' is already sold out."
}
```

**–°—Ç—Ä–∞–Ω–Ω–æ—Å—Ç—å:** –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–æ–≤–∞—Ä–∞ –≤ Shopify, —Ç–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–ª—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É –±–µ–∑ –ø—Ä–æ–±–ª–µ–º.

---

## üîç –ü—Ä–∏—á–∏–Ω—ã

### –ü—Ä–∏—á–∏–Ω–∞ 1: Metafield `seo.hidden = 1`
–í –∫–æ–¥–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ (`server_code/Shopify_API.py`) –±—ã–ª–æ:

```python
"metafields": [{
  "namespace": "seo",
  "key": "hidden",
  "type": "number_integer",
  "value": "1",  # ‚Üê –°–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä!
}]
```

–≠—Ç–æ –º–µ—Ç–∞–ø–æ–ª–µ:
- ‚ùå –°–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä –∏–∑ –ø–æ–∏—Å–∫–∞ –Ω–∞ —Å–∞–π—Ç–µ
- ‚ùå –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404 –ø—Ä–∏ –ø—Ä—è–º–æ–º –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ URL
- ‚ùå –ë–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É —á–µ—Ä–µ–∑ API (–Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ)

**–ü–æ—á–µ–º—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞ —Ä–∞–±–æ—Ç–∞–ª–æ?**  
–ü–æ—Ç–æ–º—É —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ç–æ–≤–∞—Ä–∞ –≤ admin –∏–ª–∏ —á–µ—Ä–µ–∑ –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç —ç—Ç–æ –ø–æ–ª–µ, –Ω–æ Cart API –µ–≥–æ —É—á–∏—Ç—ã–≤–∞–µ—Ç.

---

### –ü—Ä–∏—á–∏–Ω–∞ 2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Inventory Policy
–í–∞—Ä–∏–∞–Ω—Ç—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å **–±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è inventory policy**:

```python
"variants": [{
  "price": PRICE
  # –ù–µ—Ç inventoryPolicy!
  # –ù–µ—Ç inventoryItem!
}]
```

Shopify –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:
- –°–æ–∑–¥–∞–µ—Ç —Ç–æ–≤–∞—Ä —Å `inventory_quantity = 0`
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `inventory_policy = "deny"` (–Ω–µ –ø—Ä–æ–¥–∞–≤–∞—Ç—å –ø—Ä–∏ –Ω—É–ª–µ–≤–æ–º –æ—Å—Ç–∞—Ç–∫–µ)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** —Ç–æ–≤–∞—Ä —Å—á–∏—Ç–∞–µ—Ç—Å—è "sold out" —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è

---

### –ü—Ä–∏—á–∏–Ω–∞ 3: –ü–ª–æ—Ö–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ JavaScript
–í `shopify_page_script.js` –Ω–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–≤–µ—Ç–∞:

```javascript
.then(response => response.json())  // ‚Üê –ü–∞—Ä—Å–∏—Ç JSON –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ 422
```

–≠—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ —Ç–æ–º—É, —á—Ç–æ –æ—à–∏–±–∫–∏ –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∏—Å—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ.

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### –†–µ—à–µ–Ω–∏–µ 1: –£–¥–∞–ª–∏–ª–∏ `seo.hidden` metafield

**–ë—ã–ª–æ:**
```python
"metafields": [{
  "namespace": "seo",
  "key": "hidden",
  "type": "number_integer",
  "value": "1",
},
{
  "namespace": "anvil",
  "key": "id",
  "type": "single_line_text_field",
  "value": anvil_id
}]
```

**–°—Ç–∞–ª–æ:**
```python
"metafields": [{
  "namespace": "anvil",
  "key": "id",
  "type": "single_line_text_field",
  "value": anvil_id
}]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–æ–≤–∞—Ä—ã –±–æ–ª—å—à–µ –Ω–µ —Å–∫—Ä—ã—Ç—ã –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É.

---

### –†–µ—à–µ–Ω–∏–µ 2: –î–æ–±–∞–≤–∏–ª–∏ Inventory Policy

**–ë—ã–ª–æ:**
```python
"variants": [{
  "optionValues": [{
    "optionName": "Size",
    "name": "40x40cm"
  }],
  "price": PRICE
}]
```

**–°—Ç–∞–ª–æ:**
```python
"variants": [{
  "optionValues": [{
    "optionName": "Size",
    "name": "40x40cm"
  }],
  "price": PRICE,
  "inventoryPolicy": "CONTINUE",  # ‚Üê –ü—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ø—Ä–æ–¥–∞–∂—É –¥–∞–∂–µ –ø—Ä–∏ –Ω—É–ª–µ–≤–æ–º –æ—Å—Ç–∞—Ç–∫–µ
  "inventoryItem": {
    "tracked": False  # ‚Üê –ù–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å inventory
  }
}]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –¢–æ–≤–∞—Ä—ã –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç quantity
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ —É–ø—Ä–∞–≤–ª—è—Ç—å –æ—Å—Ç–∞—Ç–∫–∞–º–∏ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ "Product is already sold out" –±–æ–ª—å—à–µ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç

---

### –†–µ—à–µ–Ω–∏–µ 3: –£–ª—É—á—à–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –≤ `shopify_page_script.js`

**–ë—ã–ª–æ:**
```javascript
fetch('/cart/add.js', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ items: items })
})
.then(response => response.json())  // ‚Üê –ù–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å!
.then(data => {
  console.log('‚úÖ Success:', data);
})
```

**–°—Ç–∞–ª–æ:**
```javascript
fetch('/cart/add.js', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ items: items })
})
.then(response => {
  console.log('üì° Response status:', response.status);
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
  if (!response.ok) {
    return response.json().then(errorData => {
      console.error('‚ùå Server returned error:', errorData);
      throw new Error(errorData.description || errorData.message || 'Failed to add to cart');
    });
  }
  
  return response.json();
})
.then(data => {
  console.log('‚úÖ Successfully added to cart:', data);
  
  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
  if (typeof Shopify !== 'undefined' && Shopify.CartDrawer) {
    Shopify.CartDrawer.open();
  } else {
    window.location.href = '/cart';
  }
})
.catch(error => {
  console.error('‚ùå Error:', error);
  alert('Failed to add product to cart: ' + error.message);
});
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ 422
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏
- ‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### –†–µ—à–µ–Ω–∏–µ 4: –£–ª—É—á—à–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫—É postMessage –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–º –∫–æ–¥–µ

–î–æ–±–∞–≤–∏–ª–∏:
- –ü–∞—Ä—Å–∏–Ω–≥ JSON, –µ—Å–ª–∏ `event.data` - —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞
- –û–±—Ä–∞–±–æ—Ç–∫—É —Å–æ–±—ã—Ç–∏–π `cart_add_success` –∏ `cart_add_error`
- –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–≤–∞—Ä —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
2. –°–æ–∑–¥–∞–π—Ç–µ artwork
3. –ù–∞–∂–º–∏—Ç–µ "Add to cart"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –∫–æ—Ä–∑–∏–Ω—É
- ‚úÖ –í –∫–æ–Ω—Å–æ–ª–∏: `‚úÖ Successfully added to cart`
- ‚úÖ –ö–æ—Ä–∑–∏–Ω–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –º–∞–≥–∞–∑–∏–Ω–∞, –∑–∞—Ç–µ–º –≤ –∫–æ–Ω—Å–æ–ª–∏ (F12):

```javascript
// –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à variant_id
const variantId = 44269417169011;

fetch('/cart/add.js', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({
    items: [{id: variantId, quantity: 1}]
  })
})
.then(r => {
  console.log('Status:', r.status);
  return r.json();
})
.then(data => console.log('‚úÖ Success:', data))
.catch(err => console.error('‚ùå Error:', err));
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
Status: 200
‚úÖ Success: {id: 44269417169011, quantity: 1, ...}
```

---

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Shopify Admin

1. **Products** ‚Üí –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä
2. **Metafields:**
   - ‚úÖ `anvil.id` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å
   - ‚ùå `seo.hidden` –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å
3. **Inventory:**
   - ‚úÖ Policy: "Continue selling when out of stock"
   - ‚úÖ –ò–õ–ò Quantity > 0

---

## üìä –ú–∏–≥—Ä–∞—Ü–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤

–ï—Å–ª–∏ —É –≤–∞—Å —É–∂–µ –µ—Å—Ç—å —Ç–æ–≤–∞—Ä—ã —Å –ø—Ä–æ–±–ª–µ–º–æ–π:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
–ü—Ä–æ—Å—Ç–æ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ artwork - –æ–Ω–∏ –±—É–¥—É—Ç —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é (–¥–ª—è –≤–∞–∂–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤)

–î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞:

1. **–£–¥–∞–ª–∏—Ç—å metafield `seo.hidden`:**
   - Shopify Admin ‚Üí Products ‚Üí —Ç–æ–≤–∞—Ä
   - Metafields ‚Üí –Ω–∞–π–¥–∏—Ç–µ `seo.hidden`
   - –£–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ `0`

2. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Inventory:**
   - Variants ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç
   - Inventory ‚Üí –≤–∫–ª—é—á–∏—Ç–µ "Continue selling when out of stock"
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:

‚úÖ –¢–æ–≤–∞—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏  
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ 100% –≤—Ä–µ–º–µ–Ω–∏  
‚úÖ –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ  
‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –ø–æ–º–æ–≥–∞—é—Ç –æ—Ç–ª–∞–¥–∫–µ  
‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å "sold out"  
‚úÖ –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å 404 –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞  

---

## üìù –§–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã

1. **`server_code/Shopify_API.py`** (—Å—Ç—Ä–æ–∫–∏ 137-157)
   - –£–¥–∞–ª–µ–Ω `seo.hidden` metafield
   - –î–æ–±–∞–≤–ª–µ–Ω—ã `inventoryPolicy` –∏ `inventoryItem`

2. **`shopify_page_script.js`** (—Å—Ç—Ä–æ–∫–∏ 47-87)
   - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ fetch
   - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `response.ok`

3. **`client_code/Create/__init__.py`** (—Å—Ç—Ä–æ–∫–∏ 496-543)
   - –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ JSON –¥–ª—è postMessage
   - –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ `cart_add_success` –∏ `cart_add_error`
   - –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

**–î–∞—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2026-02-04  
**–í–µ—Ä—Å–∏—è:** 1.0
