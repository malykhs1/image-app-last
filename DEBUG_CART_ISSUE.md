# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞: –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é, –Ω–æ –Ω–µ —á–µ—Ä–µ–∑ iframe

**–°–∏—Ç—É–∞—Ü–∏—è:**
- ‚úÖ –°–æ–∑–¥–∞–µ–º –ù–û–í–´–ô —Ç–æ–≤–∞—Ä
- ‚úÖ –ß–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞ - –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è
- ‚ùå –ß–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (iframe) - –æ—à–∏–±–∫–∞ 422 "sold out"

**–í—ã–≤–æ–¥:** –ü—Ä–æ–±–ª–µ–º–∞ –ù–ï –≤ —Ç–æ–≤–∞—Ä–µ, –∞ –≤ –∑–∞–ø—Ä–æ—Å–µ –∏–∑ iframe!

---

## üß™ –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —à–∞–≥–∏

### –®–∞–≥ 1: –û—á–∏—Å—Ç–∏—Ç–µ –∫–æ—Ä–∑–∏–Ω—É

**–ü—Ä–æ–±–ª–µ–º–∞:** Shopify –º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ, –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ.

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `/cart` –Ω–∞ –≤–∞—à–µ–º —Å–∞–π—Ç–µ
2. –£–¥–∞–ª–∏—Ç–µ –í–°–ï —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —á–µ—Ä–µ–∑ iframe —Å–Ω–æ–≤–∞

---

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ (–Ω–µ iframe)

–û—Ç–∫—Ä–æ–π—Ç–µ DevTools (F12) ‚Üí **Console** ‚Üí –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ —Å–≤–µ—Ä—Ö—É –≤—ã–±–µ—Ä–∏—Ç–µ **"top"** (–Ω–µ iframe)

**–î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:**
```
üé® String Art - Cart integration script loaded
‚úì PostMessage listener registered for iframe cart operations
```

**–ï—Å–ª–∏ –ù–ï–¢** ‚Üí —Å–∫—Ä–∏–ø—Ç `shopify_page_script.js` –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ!

---

### –®–∞–≥ 3: –ü–æ—Å–ª–µ –∫–ª–∏–∫–∞ "Add to cart" –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

**–í –∫–æ–Ω—Å–æ–ª–∏ –ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
```
üì® Received postMessage: {action: 'add', variant_id: '44270397522035', ...}
üõí Adding to cart: {variant_id: '44270397522035', ...}
üñºÔ∏è Adding frame to cart as well
üöÄ Sending request to /cart/add.js with body: {"items":[...]}
üì° Response status: 422 Unprocessable Entity
‚ùå Server returned error: {status: 422, message: "...", ...}
```

**–ï—Å–ª–∏ –ù–ï–¢ —ç—Ç–∏—Ö –ª–æ–≥–æ–≤** ‚Üí postMessage –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–∫–Ω–∞!

---

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network

F12 ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Network** ‚Üí —Ñ–∏–ª—å—Ç—Ä "add.js"

–ü–æ—Å–ª–µ –∫–ª–∏–∫–∞ "Add to cart" –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è:
```
POST /cart/add.js
Status: 422
```

**–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –∑–∞–ø—Ä–æ—Å** ‚Üí –≤–∫–ª–∞–¥–∫–∞ **Request** ‚Üí **Request Payload**:

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```json
{
  "items": [
    {"id": "44270397522035", "quantity": 1},
    {"id": "43092453359731", "quantity": 1}
  ]
}
```

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
- ‚úÖ `id` - —ç—Ç–æ **–°–¢–†–û–ö–ê** (–≤ –∫–∞–≤—ã—á–∫–∞—Ö)
- ‚úÖ ID –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ (–Ω–µ –∏–∑ —Å—Ç–∞—Ä—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤)

---

### –®–∞–≥ 5: –¢–µ—Å—Ç –ù–ê–ü–†–Ø–ú–£–Æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å **–ì–õ–ê–í–ù–û–ô –°–¢–†–ê–ù–ò–¶–´** (–Ω–µ iframe), –≤—Å—Ç–∞–≤—å—Ç–µ:

```javascript
// –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à –ù–û–í–´–ô variant_id
const variantId = "44270397522035";  // ‚Üê –°–¢–†–û–ö–ê!

fetch('/cart/add.js', {
  method: 'POST',
  headers: {'Content-Type': 'application/json'},
  body: JSON.stringify({
    items: [{id: variantId, quantity: 1}]
  })
})
.then(r => {
  console.log('Status:', r.status);
  if (!r.ok) {
    return r.json().then(err => {
      console.error('‚ùå –û—à–∏–±–∫–∞:', err);
      throw err;
    });
  }
  return r.json();
})
.then(data => console.log('‚úÖ –£—Å–ø–µ—Ö:', data))
.catch(err => console.error('‚ùå –§–∏–Ω–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', err));
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

**–ï—Å–ª–∏ Status: 200** ‚Üí –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, –ö–ê–ö –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å –∏–∑ `shopify_page_script.js`

**–ï—Å–ª–∏ Status: 422** ‚Üí –ü—Ä–æ–±–ª–µ–º–∞ –≤ —Å–∞–º–æ–º —Ç–æ–≤–∞—Ä–µ –ò–õ–ò –æ–Ω —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ

---

## üéØ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã 422

### –ü—Ä–∏—á–∏–Ω–∞ 1: –¢–æ–≤–∞—Ä —É–∂–µ –≤ –∫–æ—Ä–∑–∏–Ω–µ
**–†–µ—à–µ–Ω–∏–µ:** –û—á–∏—Å—Ç–∏—Ç–µ –∫–æ—Ä–∑–∏–Ω—É –ø–æ–ª–Ω–æ—Å—Ç—å—é

### –ü—Ä–∏—á–∏–Ω–∞ 2: ID —Ä–∞–º–∫–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
**–°–∏–º–ø—Ç–æ–º—ã:** Artwork –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è, –Ω–æ frame - –Ω–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç–µ `frame_variant` (—Å—Ç—Ä–æ–∫–∞ 13 –≤ `Creation/__init__.py`):
```python
frame_variant = "–í–êSH_–ü–†–ê–í–ò–õ–¨–ù–´–ô_ID"  # ‚Üê ID –∏–∑ –ù–û–í–û–ì–û –º–∞–≥–∞–∑–∏–Ω–∞
```

–ö–∞–∫ –Ω–∞–π—Ç–∏:
1. Shopify Admin ‚Üí Products ‚Üí Frame
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç ‚Üí ID –≤ URL
3. –ó–∞–º–µ–Ω–∏—Ç–µ –≤ –∫–æ–¥–µ

### –ü—Ä–∏—á–∏–Ω–∞ 3: –†–∞–º–∫–∏ –Ω–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–æ–≤–∞—Ä Frame –≤ Shopify Admin

**–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- ‚úÖ Status: Active
- ‚úÖ Publishing: Online Store
- ‚úÖ Inventory: "Continue selling when out of stock"

---

## üîß –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –£–±—Ä–∞—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–º–∫–∏

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞–º–∫–µ, –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç–µ –µ—ë –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ:

–í `client_code/Creation/__init__.py`:

```python
def send_add_to_cart(variant_id, anvil_id, add_frame):
  # ... –∫–æ–¥ ...
  message = {
    'sender': app_origin,
    'action': 'add',
    'variant_id': str(variant_id),
    'anvil_id': anvil_id,
    'add_frame': False,  # ‚Üê –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ–º
    'frame_id': str(frame_variant),
  }
```

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –±–µ–∑ —Ä–∞–º–∫–∏. –ï—Å–ª–∏ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ —Ä–∞–º–∫–µ!

---

## üìä Checklist –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

- [ ] –ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞
- [ ] –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–µ–Ω (–ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
- [ ] postMessage –¥–æ—Ö–æ–¥–∏—Ç (–ª–æ–≥–∏ "Received postMessage")
- [ ] –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è (Network ‚Üí add.js)
- [ ] –¢–µ—Å—Ç –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å (200 –∏–ª–∏ 422?)
- [ ] ID —Ä–∞–º–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–∏–∑ –Ω–æ–≤–æ–≥–æ –º–∞–≥–∞–∑–∏–Ω–∞)
- [ ] –†–∞–º–∫–∞ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–∞ –∏ –≤ –Ω–∞–ª–∏—á–∏–∏

---

## üÜò –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

**–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ:**

1. **–õ–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ iframe:**
   ```
   CLIENT: Sending postMessage to parent window: {...}
   ```

2. **–õ–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**
   ```
   üì® Received postMessage: {...}
   üöÄ Sending request to /cart/add.js with body: ...
   ```

3. **Request Payload –∏–∑ Network:**
   ```json
   {"items": [...]}
   ```

4. **Response –∏–∑ Network:**
   ```json
   {"status": 422, "message": "..."}
   ```

–≠—Ç–æ –ø–æ–º–æ–∂–µ—Ç —Ç–æ—á–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –≥–¥–µ –ø—Ä–æ–±–ª–µ–º–∞!
